# THIS FILE WAS AUTOGENERATED BY k8s_horcrux.sh
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: pvc-signer-1
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: premium-rwo
  resources:
    requests:
      storage: 1Gi
---
apiVersion: v1
kind: ReplicationController
metadata:
  generation: 1
  name: signer-1
  namespace: default
spec:
  replicas: 1
  selector:
    app: signer-1
  template:
    metadata:
      name: signer-1
      labels:
        app: signer-1
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.io/hostname
                operator: In
                values:
                - gke-hub-horcrux-horcrux-node-pool-7144f4a7-10pj
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
                - key: "app"
                  operator: In
                  values:
                  - signer-1
            topologyKey: "kubernetes.io/hostname"
      volumes:
        - name: pv-signer-1
          persistentVolumeClaim:
            claimName: pvc-signer-1
        - name: private-share
          secret:
            secretName: private-share-1
            items:
              - key: private_share_1.json
                path: share.json
      containers:
      - name: signer-1
        image: ghcr.io/strangelove-ventures/horcrux:v2.0.0-rc1
        imagePullPolicy: Always
        ports:
          - containerPort: 2222
            protocol: TCP
            name: signer-rpc
        volumeMounts:
          - name: pv-signer-1
            mountPath: /root/.horcrux
          - name: private-share
            mountPath: "/root/share"
            readOnly: true
        command:
          - /bin/sh
          - -c
          - |
            horcrux config init cosmoshub-4 "tcp://192.168.5.4:31234,tcp://192.168.5.3:31234,tcp://192.168.5.5:31234" -c -p "tcp://signer-2:2222|2,tcp://signer-3:2222|3" -l "tcp://signer-1:2222" -k "/root/share/share.json" -t 2 --timeout 1500ms
            horcrux cosigner start
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      terminationGracePeriodSeconds: 30
---
kind: Service
apiVersion: v1
metadata:
  name: signer-1
  annotations:
    service.spec.externalTrafficPolicy: Local
spec:
  selector:
    app: signer-1
  ports:
    - protocol: TCP
      port: 2222
      name: signer-p2p
